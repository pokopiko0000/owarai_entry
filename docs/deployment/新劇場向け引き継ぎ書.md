# 🌅 日の出寄席エントリーシステム 開発引き継ぎ書

## 📋 プロジェクト概要

既存のお笑い劇場エントリーシステムをベースに、**日の出寄席**向けにカスタマイズする開発プロジェクトです。

### 🎯 ベースシステムからの主要変更点

1. **ライブ種類**: 2種類 → 1種類（日の出寄席のみ）
2. **エントリー制限**: 複雑なルール → シンプルな早い者勝ち
3. **フォーム項目**: 名義ベース → インディーズ名・演目ベース
4. **エントリー方式**: 希望制 → 複数日直接指定

## 🎭 日の出寄席の仕様

### ライブ情報
- **ライブ名**: 日の出寄席
- **定員**: 24組
- **時間**: 1時間半
- **開催頻度**: [要確認]
- **エントリー日時**: [要確認]

### エントリールール
- **複数日エントリー**: 可能（上限なし）
- **配置方式**: 早い者勝ち（受付時刻順）
- **複雑な制約なし**: 同一名義制限・同一個人制限等は不要

## 📝 エントリーフォーム仕様

### 削除する項目（既存システムから）
- ✅ ~~名義1・名義2~~
- ✅ ~~代表者1・代表者2~~
- ✅ ~~第1希望・第2希望・第3希望~~
- ✅ ~~エントリー数選択（1つ・2つ）~~

### 新しい項目
1. **インディーズ名** (必須)
   - テキスト入力フィールド
   
2. **エントリー名** (必須)
   - テキスト入力フィールド
   
3. **演目** (必須)
   - セレクトボックス
   - 選択肢: 「漫才（漫談）」「コント」「未定」
   
4. **備考** (任意)
   - テキストエリア
   - プレースホルダー例: 「出番は遅めでお願いします」「早めの時間帯希望」「特に希望なし」

### 複数日エントリー機能
- **日付と演目のセット**で管理
- 1回の送信で複数日程をエントリー可能
- 各日程ごとに演目を選択可能

## 🔧 技術的な変更点

### 1. データベーススキーマ変更

**既存のEntryテーブルから変更**:
```sql
-- 削除するフィールド
- name1, name2
- representative1, representative2  
- preference1_1, preference1_2, preference1_3
- preference2_1, preference2_2, preference2_3
- entryNumber

-- 追加するフィールド
+ indies_name VARCHAR(255) NOT NULL
+ entry_name VARCHAR(255) NOT NULL
+ performance_type VARCHAR(50) NOT NULL  -- '漫才（漫談）' | 'コント' | '未定'
+ remarks TEXT                          -- 備考欄
+ target_date DATE NOT NULL             -- エントリー対象日
```

### 2. 複数日エントリーのデータ構造

```typescript
// 1回のエントリー送信で複数レコード作成
type EntrySubmission = {
  email: string
  entries: Array<{
    indies_name: string
    entry_name: string
    performance_type: '漫才（漫談）' | 'コント' | '未定'
    target_date: string  // YYYY-MM-DD
    remarks?: string
  }>
}
```

### 3. UI/UXの変更

#### エントリーフォーム (`/app/page.tsx`)
- ライブタイプ選択を削除（日の出寄席固定）
- 複数日エントリーのためのインターフェース追加
- 日付・演目の組み合わせを動的に追加/削除可能に

#### 管理画面 (`/app/admin/page.tsx`)
- 口火・二足のわらじタブを削除
- 日の出寄席のみの表示
- 新しいフィールドに対応した表示

#### 香盤表 (`/app/schedule/page.tsx`)
- 1種類のライブのみ表示
- インディーズ名・エントリー名・演目を表示

### 4. 振り分けアルゴリズム (`/lib/assignment.ts`)

**大幅簡素化**:
- 複雑な制約チェックを削除
- 受付時刻順でのシンプルな先着順
- 定員24組までの配置

```typescript
// 簡素化されたロジック
const assignEntries = (entries: Entry[], live: Live) => {
  // 1. 受付時刻順でソート
  const sortedEntries = entries.sort(by timestamp)
  
  // 2. 先着24組まで配置
  const assigned = sortedEntries.slice(0, 24)
  const waiting = sortedEntries.slice(24)
  
  return { assigned, waiting }
}
```

## 📱 開発優先順位

### Phase 1: 基本機能の移行
1. データベーススキーマの変更
2. 基本的なエントリーフォームの作成（単一日エントリー）
3. 管理画面の調整
4. 香盤表の調整

### Phase 2: 複数日エントリー機能
1. フロントエンドの複数日UI実装
2. API の複数レコード作成対応
3. 管理画面での複数エントリー表示

### Phase 3: 細かい調整
1. UIの最終調整
2. バリデーション強化
3. テスト・デバッグ

## ⚠️ 注意事項

### データベース
- **必ず新しいデータベースを作成**
- 既存のデータベースと混在させない
- マイグレーションファイルは新規作成

### 環境設定
```bash
# 新しい環境変数
DATABASE_URL="新しいNeonプロジェクトのURL"
NEXT_PUBLIC_STAFF_REVIEW_MODE="true"  # 開発時のみ
```

### 既存コードの再利用
- 認証システム: そのまま利用可能
- 基本的なUI構造: 再利用可能
- 時間制限機能: そのまま利用可能（エントリー日時要確認）

## 📋 確認が必要な事項

1. **エントリー受付日時**: 毎月何日の何時から？
2. **開催頻度**: 月何回開催？
3. **エントリー締切**: 何分間受付？
4. **香盤表公開タイミング**: いつ公開？

## 🚀 開発開始手順

1. **新しいデータベース作成**
2. **環境変数設定**
3. **既存コード確認**
4. **要件確認（上記の確認事項）**
5. **Phase 1から開発開始**

## 📞 技術サポート

このドキュメントでカバーしきれない技術的な詳細は、`CLAUDE.md`と既存のコードコメントを参照してください。

---

**開発開始前に、上記の「確認が必要な事項」について詳細を確認することを強く推奨します。**