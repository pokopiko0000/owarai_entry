# 🎭 お笑い劇場エントリーシステム

お笑い劇場のライブエントリー業務をデジタル化するシステム。公平性の確保と業務効率化を実現する（最小コストで最大効果）。

## 🎯 対象ライブ

- **口火ライブ**: 毎月1日22:00エントリー開始、月10-15回開催、各回9-11組
- **二足のわらじライブ**: 毎月10日22:00エントリー開始、月4回開催、各回16-17組

## 🛠️ 技術スタック

- **フロントエンド**: Next.js 14 + TypeScript
- **バックエンド**: Next.js API Routes
- **データベース**: PostgreSQL（Neon）
- **インフラ**: Vercel
- **スタイリング**: Tailwind CSS

## 📱 主要機能

1. **エントリー機能（演者向け）**
   - 一括エントリーフォーム（最大2名義まで）
   - 21:50から入力可能、22:00送信開始、22:30自動締切
   - 第1〜第3希望まで選択可能

2. **自動振り分け機能**
   - 受付時刻順での先着優先
   - 同一名義：月1回まで
   - 同一個人：月2回まで（代表者名で判定）

3. **香盤表ページ**
   - 出演結果の確認（23:00頃更新）
   - 常時閲覧可能

4. **管理機能（スタッフ向け）**
   - エントリー状況監視
   - 振り分け結果の確認・調整
   - 香盤表確定機能

## 🚀 セットアップ

```bash
# 依存関係のインストール
npm install

# データベースの初期化
npx prisma generate
npx prisma migrate deploy

# 開発サーバーの起動
npm run dev
```

## 🌐 URL構成

- `/` - エントリーフォーム
- `/schedule` - 香盤表ページ
- `/admin` - スタッフ管理画面

## ⚙️ 環境変数

```bash
DATABASE_URL="your-postgresql-connection-string"
NEXT_PUBLIC_STAFF_REVIEW_MODE="false"  # 本番環境では必ずfalse
```

## 🏗️ プロジェクト構成

```
app/
├── page.tsx              # エントリーフォーム
├── admin/page.tsx        # 管理画面
├── schedule/page.tsx     # 香盤表
├── complete/page.tsx     # 完了画面
└── api/                  # API endpoints
    ├── entry/route.ts    # エントリー送信
    ├── assign/route.ts   # 自動振り分け
    ├── lives/route.ts    # ライブ情報取得
    └── schedule/route.ts # 香盤表データ取得

lib/
├── db.ts                 # データベース接続
└── assignment.ts         # 振り分けアルゴリズム

prisma/
├── schema.prisma         # データベーススキーマ
└── migrations/           # データベースマイグレーション
```

## 🤖 振り分けアルゴリズム

1. **基本方針**: 受付時刻順での先着優先
2. **制約条件**:
   - 同一名義：月1回まで
   - 同一個人：月2回まで（代表者名で判定）
   - 各回の組数：口火9-11組、二足のわらじ16-17組
3. **処理順序**:
   - エントリー時刻順でソート
   - 第1希望から順番に配置試行
   - 制約違反の場合は次の希望で再試行
   - 全希望で配置不可の場合は補欠リスト

## 🌐 デプロイ（Vercel）

### 環境変数設定
```
DATABASE_URL="postgresql://user:password@host:5432/database"
NEXT_PUBLIC_STAFF_REVIEW_MODE="false"
```

### 運用コスト
- **平常時**: 無料（Vercel + Neon無料枠）
- **ピーク時**: $20/月（Vercel Pro プラン）

## 📋 開発ガイドライン

詳細な開発情報は `CLAUDE.md` を参照してください。

## 🔄 新しい劇場向けの複製

このシステムを他の劇場向けに複製する場合：

1. **新しいリポジトリを作成**
2. **新しいデータベースを作成**（Neonで新プロジェクト）
3. **環境変数を更新**（DATABASE_URL等）
4. **劇場固有設定をカスタマイズ**
   - ライブ名
   - エントリールール
   - UIカラー
   - 日時設定

## 📄 ライセンス

MIT License